%macro pushaq 0
push rax
push rbx
push rcx
push rdx
push rsi
push rdi
push r8
push r9
push r10
push r11
push r12
push r13
push r14
push r15
%endmacro
%macro popaq 0
pop r15
pop r14
pop r13
pop r12
pop r11
pop r10
pop r9
pop r8
pop rdi
pop rsi
pop rdx
pop rcx
pop rbx
pop rax
%endmacro
section .data
deadly_exceptionmsg dw "deadly exception", 0
section .text
global default_isr
global isr0
extern sys_print
deadly_exception:
pushaq
mov rbx, deadly_exceptionmsg
call sys_print
popaq
hlt
ret
default_isr:
sti
iretq
isr0:
cli
pushaq
push qword 0
call deadly_exception
add rsp, 8
popaq
sti
iretq

